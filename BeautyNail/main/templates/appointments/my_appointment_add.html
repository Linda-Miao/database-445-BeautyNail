{% extends 'base.html' %}
{% block content %}
<div
  class="d-flex justify-content-center align-items-center"
  style="min-height: 80vh"
>
  <div>
    <h2 class="text-center mb-4">Add Appointment</h2>
    <form method="post" action="{% url 'my_appointment_add' %}">
      {% csrf_token %}
      <table>
        <tr>
          <td><label for="staff_id">Staff:</label></td>
          <td>
            <select id="staff_id" name="staff_id" required>
              <option value="">-- Select Active Staff --</option>
              {% for s in staff_opts %}
              <option value="{{ s.id }}">
                {{ s.name }}{% if s.specialty %} — {{ s.specialty }}{% endif %}
              </option>
              {% endfor %}
            </select>
          </td>
        </tr>
        <tr>
          <td><label for="appointment_date">Date:</label></td>
          <td>
            <input
              type="date"
              id="appointment_date"
              name="appointment_date"
              required
            />
          </td>
        </tr>
        <tr>
          <td><label for="start_time">Start Time:</label></td>
          <td>
            <input type="time" id="start_time" name="start_time" required />
          </td>
        </tr>
        <tr>
          <td><label for="end_time">End Time:</label></td>
          <td><input type="time" id="end_time" name="end_time" /></td>
        </tr>
        <!-- status is not shown because it's auto-set to pending -->
        <tr>
          <td valign="top"><label>Services:</label></td>
          <td>
            <div id="services-list">
              <div class="service-row mb-2">
                <select
                  name="service_ids[]"
                  class="form-select d-inline-block"
                  style="width: 320px"
                >
                  <option value="">-- Select Service --</option>
                  {% for s in svc_opts %}
                  <option value="{{ s.id }}">
                    {{ s.name }} (${{ s.price }})
                  </option>
                  {% endfor %}
                </select>
                <input
                  type="text"
                  name="polish_colors[]"
                  class="form-control d-inline-block ms-2"
                  style="width: 180px"
                  placeholder="Polish color (optional)"
                />
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm ms-2"
                  onclick="addServiceRow()"
                >
                  +
                </button>
                <button
                  type="button"
                  class="btn btn-outline-secondary btn-sm ms-1"
                  onclick="removeServiceRow(this)"
                >
                  −
                </button>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td><label for="notes">Notes:</label></td>
          <td>
            <textarea id="notes" name="notes" rows="3" cols="40"></textarea>
          </td>
        </tr>
        <tr>
          <td colspan="2" style="text-align: center; padding-top: 12px">
            <button type="submit" class="btn btn-success me-2">
              Add Appointment
            </button>
            <a href="{% url 'my_appointments' %}" class="btn btn-secondary"
              >Cancel</a
            >
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>

<script>
  function addServiceRow() {
    const container = document.getElementById("services-list");
    const first = container.querySelector(".service-row");
    const clone = first.cloneNode(true);

    // reset fields
    const sel = clone.querySelector('select[name="service_ids[]"]');
    if (sel) sel.value = "";
    const colorInput = clone.querySelector('input[name="polish_colors[]"]');
    if (colorInput) colorInput.value = "";

    container.appendChild(clone);
  }
  function removeServiceRow(btn) {
    const container = document.getElementById("services-list");
    const rows = container.querySelectorAll(".service-row");
    if (rows.length > 1) {
      btn.closest(".service-row").remove();
    }
  }
</script>
{% endblock %}

{% extends 'base.html' %}
{% block content %}
<h2>My Appointments</h2>


<form method="get" class="mb-3">
  <div class="input-group">
    <input type="text" name="search" class="form-control"
           placeholder="Search by staff, status, date (YYYY-MM-DD), or ID..."
           value="{{ search_query|default:'' }}">
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </div>
</form>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Date</th>
            <th>Start</th>
            <th>End</th>
            <th>Status</th>
            <th>Total Amount</th>
            <th>Staff</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for appt in appointments %}
        <tr>
            <td>{{ appt.date }}</td>
            <td>{{ appt.start|default:"-"|time:"g:i A" }}</td>
            <td>{{ appt.end|default:"-"|time:"g:i A" }}</td>
            <td>{{ appt.status }}</td>
            <td>
                {% if appt.total %}
                    ${{ appt.total }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>{{ appt.staff_name }}</td>
            <td class="actions-cell">
                {% if appt.status|lower == 'pending' or appt.status|lower == 'scheduled' %}
    <a href="{% url 'my_appointment_edit' appt.id %}" class="btn btn-sm btn-warning">Edit</a>
  {% endif %}

  {% if appt.status|lower == 'completed' %}
    {% if appt.review_id %}
      <a href="{% url 'my_review_edit' appt.review_id %}" class="btn btn-sm btn-primary ms-1">Edit Review</a>
    {% else %}
      <a href="{% url 'my_review_add' appt.id %}" class="btn btn-sm btn-success ms-1">Give a Review</a>
    {% endif %}
  {% endif %}

  {% if appt.status|lower != 'pending' and appt.status|lower != 'scheduled' and appt.status|lower != 'completed' %}
    <span class="text-muted">No Actions</span>
  {% endif %}
            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="7" class="text-center">You have no appointments yet.</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<form method="get" action="" class="mb-3" style="display:inline;">
  <a href="{% url 'my_appointments' %}" class="btn btn-secondary btn-sm">Show All</a>
</form>
<a href="{% url 'my_appointment_add' %}" class="btn btn-success btn-sm ms-2">+ Book New Appointment</a>
{% endblock %}
